@page "/warehouse"
@inject WarehouseService Service
@using HelloOrleans.Models;

<h3>Warehouse</h3>


<input @bind="@_goodsId" placeholder="Id" />
<input @bind="@_goodsName" placeholder="Goods Name" />
<button @onclick="@Add">
    Add New Basic Goods
</button>

<table class="table">
    <thead>
        <tr>
            <th>Id</th>
            <th>Goods Name</th>
        </tr>
    </thead>
    <tbody>

        @if (_allBasicGoods != null)
        {
            @foreach (var item in _allBasicGoods)
            {
                <tr>
                    <td>@item.Id</td>
                    <td>@item.GoodsName</td>
                </tr>
            }
        }
    </tbody>
</table>


@code {

    private int? _goodsId;
    private string _goodsName;

    private BasicGoods[] _allBasicGoods;

    protected override async Task OnInitializedAsync()
    {
        await this.GetAllGoods();
    }

    private async Task GetAllGoods()
    {
        var t = await Service.All();
        _allBasicGoods = t.ToArray();
    }

    private async Task Add()
    {
        if (_goodsId == null || string.IsNullOrWhiteSpace(_goodsName))
            return;
        if (_allBasicGoods.Select(x => x.Id).ToList().Contains(_goodsId.GetValueOrDefault())
            || _allBasicGoods.Select(x => x.GoodsName).ToList().Contains(_goodsName))
            return;
        await Service.Add(new BasicGoods()
        {
            Id = this._goodsId.GetValueOrDefault(),
            GoodsName = this._goodsName
        });
        _goodsId = null;
        _goodsName = null;
        await this.GetAllGoods();
    }
}
